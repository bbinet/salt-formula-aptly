{%- from "aptly/map.jinja" import server with context %}
{
  "rootDir": "{{ server.root_dir }}",
  "downloadConcurrency": 4,
  "architectures": [ "amd64" ],
  "dependencyFollowSuggests": false,
  "dependencyFollowRecommends": false,
  "dependencyFollowAllVariants": false,
  "dependencyFollowSource": false,
  {%- if server.endpoint is defined %}
  "S3PublishEndpoints": {
    {%- for name, endpoint in server.endpoint.iteritems %}
    {%- if endpoint.engine == 's3' %}
    "{{ name }}": {
      {%- for key, value in endpoint.iteritems() %}
      "{{ key }}": "{{ value }}"{% if not loop.last %},{% endif %}
      {%- endfor %}
    }
    {%- endif %}
    {%- endfor %}
  },
  "SwiftPublishEndpoints": {
    {%- for name, endpoint in server.endpoint.iteritems %}
    {%- if endpoint.engine == 'swift' %}
    "{{ name }}": {
      {%- for key, value in endpoint.iteritems() %}
      "{{ key }}": "{{ value }}"{% if not loop.last %},{% endif %}
      {%- endfor %}
    }
    {%- endif %}
    {%- endfor %}
  }
  {%- endif %}
  {%- if server.secure %}
  "gpgDisableSign": false,
  "gpgDisableVerify": false,
  {%- else %}
  "gpgDisableSign": true,
  "gpgDisableVerify": true,
  {%- endif %}
  "downloadSourcePackages": false,
  "ppaDistributorID": "ubuntu",
  "ppaCodename": ""
}
